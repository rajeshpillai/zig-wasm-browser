<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Zig Wasm - Arrays</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        button {
            padding: 10px;
            cursor: pointer;
            margin-top: 10px;
        }

        .box {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <h1>05: Arrays and Slices</h1>
    <p>We will send an array of numbers to Zig, have Zig multiply them by 2, and read them back.</p>

    <div class="box">
        <p>Input: <span id="inputDisplay">[1, 2, 3, 4, 5]</span></p>
        <button id="btnProcess">Process in Zig (x2)</button>
        <p>Output: <b id="outputDisplay">?</b></p>
    </div>

    <script>
        let exports;
        let memory;

        WebAssembly.instantiateStreaming(fetch('05-arrays-slices.wasm'), {})
            .then(obj => {
                exports = obj.instance.exports;
                memory = exports.memory;
            });

        document.getElementById('btnProcess').onclick = () => {
            const inputData = new Int32Array([1, 2, 3, 4, 5]);

            // 1. Get pointer to our Zig buffer
            const ptr = exports.get_input_buffer_ptr();

            // 2. Create a view on Wasm memory at that pointer
            // Note: dividing by 4 because Int32 takes 4 bytes per element
            const wasmSlice = new Int32Array(memory.buffer, ptr, inputData.length);

            // 3. Copy data into Wasm memory
            wasmSlice.set(inputData);

            // 4. Call Zig function to process
            exports.process_array(inputData.length);

            // 5. Read the result back (the memory is modified in place)
            // We can read from the same view 'wasmSlice' because it's a live view!
            const result = Array.from(wasmSlice); // Convert to JS array for display

            document.getElementById('outputDisplay').innerText = `[${result.join(', ')}]`;
        };
    </script>
</body>

</html>